{% extends "_main.html" %}
{% block head %}
<style>

    form{
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 10px;
        border: 5px solid var(--bs-danger-border-subtle);
        border-radius: 20px;
        padding: 20px;
        margin: 0 30% 0 30%;
    }
    form input, form textarea{
        width: 100%;
        padding: 10px;
        border: 2px solid var(--bs-primary);
        border-radius: 10px;
        background: var(--bs-gray-500);
    }
    form #btn{
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-self: center;
        gap: 10px;
    }
    form #reset{
        padding: 10px;
        border: 2px solid var(--bs-danger-border-subtle);
        background-color: var(--bs-danger);
    }
    form #reset:hover{
        background-color: var(--bs-danger-bg-subtle);
    }
    form #submit{
        padding: 10px;
        border: 2px solid var(--bs-success-border-subtle);
        background-color: var(--bs-success);
    }
    form #submit:hover{
        background-color: var(--bs-success-bg-subtle);
    }
    #progressStatus{
        width: 0;
        background-color: red;
    }
 </style>
{% endblock %}
{% block title %}Add Book{% endblock %}
{% block body %}
<h1 align="center">Insert a Book</h1>
<form id="uploadForm" action="{{ url_for('book_insert' ) }}" method="POST" enctype="multipart/form-data">
    {{ form.hidden_tag() }}
    {{ form.book_name(placeholder="Book Name") }}
    {{ form.author(placeholder="Author Name") }}
    {{ form.password(placeholder="Password") }}
    {{ form.bookpdf }}
    {{ form.description(placeholder="Description of the book ............", rows="7") }}
    <div id="btn">
        {{ form.submit }}
        <input id="reset" type="reset" value="Reset">
    </div>
</form>
<div align="center" id="progressBar">
  <div id="progressStatus"></div>
</div>
<script>
    $(document).ready(function() {
        $('#uploadForm').submit(function(e) {
          e.preventDefault();
          let formData = new FormData(this);
    
          $.ajax({
            url: '{{url_for("book_insert")}}',
            type: 'POST',
            data: formData,
            contentType: false,
            processData: false,
            xhr: function() {
              let xhr = new window.XMLHttpRequest();
              xhr.upload.addEventListener('progress', function(e) {
                if (e.lengthComputable) {
                  let percentage = Math.round((e.loaded / e.total) * 100);
                  $('#progressStatus').css('width', percentage + '%').html(percentage + '%');
                }
              });
              return xhr;
            },
            success: function(response) {
              console.log('Upload completed!');
            }
          });
        });
      });
</script>
{% endblock %}